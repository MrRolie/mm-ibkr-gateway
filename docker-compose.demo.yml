version: '3.8'

services:
  # Demo service - showcases system capabilities
  demo:
    build:
      context: .
      target: development
    container_name: ibkr-gateway-demo
    environment:
      # IBKR Connection (host.docker.internal for connecting to host machine)
      - IBKR_GATEWAY_HOST=host.docker.internal
      - PAPER_GATEWAY_PORT=4002
      - PAPER_CLIENT_ID=3

      # Trading Mode (demo requires paper mode)
      - TRADING_MODE=paper
      - ORDERS_ENABLED=false

      # API Server
      - API_PORT=8000
      - LOG_LEVEL=INFO
    volumes:
      # Mount source code
      - .:/app
      - /app/.venv
      - /app/__pycache__
    networks:
      - ibkr-demo-network
    command: python -m ibkr_core.demo
    restart: "no"
    extra_hosts:
      # Allow container to connect to host machine (for IBKR Gateway/TWS)
      - "host.docker.internal:host-gateway"

networks:
  ibkr-demo-network:
    driver: bridge
